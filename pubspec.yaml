name: tele_deck
description: "TeleDeck - System IME Keyboard with Secondary Display Support"
publish_to: 'none'

version: 1.0.0+1

environment:
  sdk: ">=3.8.0 <4.0.0"

workspace:
  # Core library packages
  - app_lib/tele_theme
  - app_lib/tele_models
  - app_lib/tele_services
  - app_lib/tele_logging
  - app_lib/tele_constants
  # BLoC state management packages
  - app_bloc/keyboard_bloc
  - app_bloc/settings_bloc
  - app_bloc/setup_bloc
  # Widget packages
  - app_widget/keyboard_widgets
  - app_widget/settings_widgets
  - app_widget/common_widgets
  # Plugin packages
  - app_plugin/tele_crash_logger
  - app_plugin/tele_presentation
  - app_plugin/tele_ime
  # Third-party packages
  - third_party/form_bloc
  - third_party/flutter_form_bloc

dependencies:
  flutter:
    sdk: flutter

  # Core dependencies
  logging: ^1.3.0
  go_router: ^17.0.1

  # State management (BLoC)
  bloc: ^9.0.0
  flutter_bloc: ^9.0.0
  equatable: ^2.0.7
  rxdart: ^0.28.0

  # Persistence
  shared_preferences: ^2.3.5
  path_provider: ^2.1.5
  path: any

  # UI
  cupertino_icons: ^1.0.8
  google_fonts: ^6.2.1

  # Workspace packages - Core library
  tele_theme: any
  tele_models: any
  tele_services: any
  tele_logging: any
  tele_constants: any
  # Workspace packages - BLoC
  keyboard_bloc: any
  settings_bloc: any
  setup_bloc: any
  # Workspace packages - Widgets
  keyboard_widgets: any
  settings_widgets: any
  common_widgets: any
  # Workspace packages - Plugins
  tele_crash_logger: any
  tele_presentation: any
  tele_ime: any
  # Workspace packages - Third-party
  form_bloc: any
  flutter_form_bloc: any

dev_dependencies:
  flutter_test:
    sdk: flutter

  flutter_lints: ^6.0.0
  build_runner: ^2.4.15
  melos: ^7.0.0
  dependency_validator: ^5.0.2

flutter:
  uses-material-design: true

melos:
  name: tele_deck
  command:
    version:
      branch: main
      releaseUrl: true

  scripts:
    prepare:
      description: Prepare project with bootstrap and build_runner
      steps:
        - melos bootstrap
        - melos run build-runner

    build-runner:
      run: dart run build_runner build --delete-conflicting-outputs
      exec:
        orderDependents: true
      description: Run build_runner for all packages.

    analyze:
      description: Run flutter analyze for all packages.
      run: flutter analyze --no-fatal-infos --no-fatal-warnings
      exec:
        concurrency: 1
        orderDependents: true
      packageFilters:
        flutter: true

    fix:
      run: dart fix . --apply
      exec:
        orderDependents: true
      description: Run dart fix for all packages.

    format:
      run: dart format .
      exec:
        orderDependents: true
      description: Run dart format for all packages.

    format-check:
      run: dart format . --set-exit-if-changed
      exec:
        orderDependents: true
      description: Run dart format checks for all packages.

    upgrade:
      run: dart pub upgrade --major-versions
      exec:
        orderDependents: true
      description: Upgrade dependencies in all packages.

    outdated:
      run: dart pub outdated
      exec:
        orderDependents: true
      description: Check outdated dependencies in all packages.

    validate-dependencies:
      run: dart run dependency_validator
      description: Check dependencies usage.

    test:
      description: Run tests for all packages.
      steps:
        - melos run test:flutter

    test:flutter:
      run: flutter test
      exec:
        orderDependents: true
        fail-fast: true
      packageFilters:
        flutter: true
        dirExists: test
